<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VetQuizApp - U.P.T.N.T. Manuela Saenz</title>
    <style>
        /* ... (todo el CSS permanece igual) ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- ... (todo el HTML permanece igual) ... -->
    </div>

    <script>
        // ---------- TODAS LAS 50 PREGUNTAS ----------
        const questions = [
            // ... (todas las 50 preguntas permanecen igual) ...
        ];

        // ---------- VARIABLES GLOBALES ----------
        let currentScreen = 'start';
        let selectedQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let score = 0;
        let wrongQuestions = [];
        let currentLanguage = 'en';
        let studentData = { name: '', doc: '' };
        let teacherCredentials = { username: 'Coach', password: '19082008' };

        // ---------- FUNCIONES DE NAVEGACIÓN CORREGIDAS ----------
        function showScreen(screenName) {
            console.log('Intentando mostrar pantalla:', screenName); // Para debug
            
            // Ocultar todas las pantallas
            const screens = [
                'start-screen',
                'teacher-login', 
                'quiz-screen',
                'results-screen',
                'teacher-menu',
                'ranking-screen',
                'wrong-answers-screen'
            ];
            
            screens.forEach(screenId => {
                const element = document.getElementById(screenId);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            // Mostrar la pantalla solicitada
            const targetScreen = document.getElementById(screenName + '-screen');
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                currentScreen = screenName;
                console.log('Pantalla mostrada correctamente:', screenName); // Para debug
            } else {
                console.error('No se encontró la pantalla:', screenName + '-screen');
            }
        }

        function showStartScreen() {
            showScreen('start');
        }

        function showTeacherLogin() {
            showScreen('teacher-login');
        }

        function showTeacherMenu() {
            showScreen('teacher-menu');
        }

        function showResultsScreen() {
            showScreen('results');
        }

        // ---------- FUNCIONES DEL QUIZ (permanecen igual) ----------
        function startQuiz() {
            const name = document.getElementById('name-input').value.trim();
            const doc = document.getElementById('doc-input').value.trim();
            
            if (!name || !doc) {
                alert('Please enter your full name and student ID.');
                return;
            }
            
            studentData = { name, doc };
            
            // Seleccionar 10 preguntas aleatorias
            selectedQuestions = [...questions].sort(() => 0.5 - Math.random()).slice(0, 10);
            currentQuestionIndex = 0;
            userAnswers = {};
            score = 0;
            wrongQuestions = [];
            currentLanguage = 'en';
            
            showScreen('quiz');
            loadQuestion();
        }

        function loadQuestion() {
            // ... (código permanece igual) ...
        }

        function selectOption(option, button) {
            // ... (código permanece igual) ...
        }

        function toggleLanguage() {
            // ... (código permanece igual) ...
        }

        function nextQuestion() {
            // ... (código permanece igual) ...
        }

        function prevQuestion() {
            // ... (código permanece igual) ...
        }

        function finishQuiz() {
            // ... (código permanece igual) ...
        }

        function showWrongAnswers() {
            // ... (código permanece igual) ...
        }

        // ---------- FUNCIONES DE PROFESOR CORREGIDAS ----------
        function verifyLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            console.log('Verificando login:', username, password); // Para debug
            
            if (username === teacherCredentials.username && password === teacherCredentials.password) {
                console.log('Login exitoso, mostrando menú teacher'); // Para debug
                showTeacherMenu();
            } else {
                alert('Invalid credentials. Please try again.');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('username').focus();
            }
        }

        function changeUsername() {
            const newUsername = prompt('Enter new username:', teacherCredentials.username);
            if (newUsername && newUsername.trim()) {
                teacherCredentials.username = newUsername.trim();
                alert('Username updated successfully!');
            }
        }

        function changePassword() {
            const newPassword = prompt('Enter new password:');
            if (newPassword && newPassword.trim()) {
                teacherCredentials.password = newPassword.trim();
                alert('Password updated successfully!');
            }
        }

        function deleteDatabase() {
            if (confirm('Are you sure you want to delete ALL student results?\nThis action cannot be undone.')) {
                localStorage.removeItem('quizResults');
                alert('All results deleted successfully!');
            }
        }

        function viewRanking() {
            const results = getResults();
            const container = document.getElementById('ranking-table-container');
            
            if (results.length === 0) {
                container.innerHTML = '<p>No results found.</p>';
            } else {
                let html = `
                    <table class="ranking-table">
                        <tr>
                            <th>Pos</th>
                            <th>Name</th>
                            <th>ID</th>
                            <th>Score</th>
                            <th>Percentage</th>
                            <th>Rounded</th>
                            <th>Date</th>
                        </tr>
                `;
                
                results.sort((a, b) => b.percentage - a.percentage);
                
                results.forEach((result, index) => {
                    let rowClass = '';
                    if (index === 0) rowClass = 'gold';
                    else if (index === 1) rowClass = 'silver';
                    else if (index === 2) rowClass = 'bronze';
                    
                    const date = new Date(result.timestamp).toLocaleDateString();
                    
                    html += `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td>${result.name}</td>
                            <td>${result.doc}</td>
                            <td>${result.score}</td>
                            <td>${result.percentage}%</td>
                            <td><strong>${result.roundedScore}</strong></td>
                            <td>${date}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                container.innerHTML = html;
            }
            
            showScreen('ranking');
        }

        // ---------- ALMACENAMIENTO (localStorage) ----------
        function saveResult(name, doc, score, percentage, roundedScore) {
            const results = getResults();
            results.push({
                name,
                doc,
                score: score.toFixed(1),
                percentage: percentage.toFixed(1),
                roundedScore,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('quizResults', JSON.stringify(results));
        }

        function getResults() {
            return JSON.parse(localStorage.getItem('quizResults') || '[]');
        }

        function exportToExcel() {
            const results = getResults();
            if (results.length === 0) {
                alert('No results to export.');
                return;
            }
            
            let csvContent = "Name,ID,Score,Percentage,Rounded Score,Date\n";
            results.forEach(result => {
                const date = new Date(result.timestamp).toLocaleDateString();
                csvContent += `"${result.name}","${result.doc}",${result.score},${result.percentage},${result.roundedScore},${date}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'VetQuiz_Results.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('Results exported as CSV file!');
        }

        function exportToCSV() {
            exportToExcel();
        }

        // Inicializar
        showStartScreen();

        // Event listeners para Enter key
        document.getElementById('name-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('doc-input').focus();
            }
        });

        document.getElementById('doc-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                startQuiz();
            }
        });

        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('password').focus();
            }
        });

        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyLogin();
            }
        });

        // Debug: Verificar que todas las pantallas existen
        console.log('Pantallas disponibles:');
        console.log('- start-screen:', document.getElementById('start-screen'));
        console.log('- teacher-login-screen:', document.getElementById('teacher-login-screen'));
        console.log('- quiz-screen:', document.getElementById('quiz-screen'));
        console.log('- results-screen:', document.getElementById('results-screen'));
        console.log('- teacher-menu-screen:', document.getElementById('teacher-menu-screen'));
        console.log('- ranking-screen:', document.getElementById('ranking-screen'));
        console.log('- wrong-answers-screen:', document.getElementById('wrong-answers-screen'));
    </script>
</body>
</html>
