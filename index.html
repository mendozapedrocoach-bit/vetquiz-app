<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VetQuizApp - Versi√≥n Web</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-success {
            background: #27ae60;
        }
        .btn-success:hover {
            background: #219a52;
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-warning {
            background: #f39c12;
        }
        .btn-warning:hover {
            background: #d35400;
        }
        .question {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        .options {
            margin: 15px 0;
        }
        .option {
            display: block;
            margin: 10px 0;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .option:hover {
            background: #d6dbdf;
        }
        .option.selected {
            background: #3498db;
            color: white;
        }
        .score-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: #ecf0f1;
        }
        .progress-bar {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: #3498db;
            transition: width 0.3s;
        }
        .hidden {
            display: none;
        }
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .ranking-table th, .ranking-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .ranking-table th {
            background: #34495e;
            color: white;
        }
        .ranking-table tr:nth-child(even) {
            background: #f2f2f2;
        }
        .gold {
            background: #FFD700 !important;
            font-weight: bold;
        }
        .silver {
            background: #C0C0C0 !important;
            font-weight: bold;
        }
        .bronze {
            background: #CD7F32 !important;
            font-weight: bold;
            color: white;
        }
        .wrong-answer {
            color: #e74c3c;
            font-weight: bold;
        }
        .correct-answer {
            color: #27ae60;
            font-weight: bold;
        }
        .language-toggle {
            float: right;
            background: #95a5a6;
        }
        .language-toggle:hover {
            background: #7f8c8d;
        }
        .input-field {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .input-field:focus {
            border-color: #3498db;
            outline: none;
        }
        .form-group {
            margin: 20px 0;
        }
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>VetQuizApp ü©∫</h1>
        <div class="subtitle">U.P.T.N.T. Manuela Saenz - Versi√≥n Web</div>
        
        <!-- Pantalla de inicio -->
        <div id="start-screen">
            <h2>Bienvenido al Quiz de Veterinaria</h2>
            <p>Este quiz contiene 50 preguntas sobre diferentes animales dom√©sticos y sus caracter√≠sticas. 
               Se seleccionar√°n 10 preguntas al azar para cada intento.</p>
            
            <div class="form-group">
                <label for="student-name" class="form-label">Nombre del Estudiante:</label>
                <input type="text" id="student-name" class="input-field" placeholder="Ingresa tu nombre completo">
            </div>
            
            <div class="form-group">
                <label for="student-id" class="form-label">ID del Estudiante:</label>
                <input type="text" id="student-id" class="input-field" placeholder="Ingresa tu n√∫mero de identificaci√≥n">
            </div>
            
            <button class="btn btn-success" onclick="startQuiz()">Comenzar Quiz</button>
            <button class="btn" onclick="showTeacherLogin()">Acceso para Profesores</button>
        </div>
        
        <!-- Pantalla de login para profesores -->
        <div id="teacher-login" class="hidden">
            <h2>Acceso para Profesores</h2>
            <div class="form-group">
                <label for="username" class="form-label">Usuario:</label>
                <input type="text" id="username" class="input-field" value="Coach">
            </div>
            <div class="form-group">
                <label for="password" class="form-label">Contrase√±a:</label>
                <input type="password" id="password" class="input-field" value="19082008">
            </div>
            <button class="btn btn-success" onclick="verifyLogin()">Ingresar</button>
            <button class="btn" onclick="showStartScreen()">Volver</button>
        </div>
        
        <!-- Men√∫ de administraci√≥n -->
        <div id="admin-menu" class="hidden">
            <h2>Panel de Administraci√≥n üßë‚Äçüè´</h2>
            <button class="btn" onclick="viewRanking()">üìä Ver Resultados y Ranking</button>
            <button class="btn" onclick="showStartScreen()">‚¨ÖÔ∏è Volver al Men√∫ Principal</button>
            
            <div id="ranking-results" class="hidden">
                <h3>Ranking de Estudiantes</h3>
                <table class="ranking-table" id="ranking-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Nombre</th>
                            <th>ID</th>
                            <th>Puntaje</th>
                            <th>Porcentaje</th>
                            <th>Puntaje Redondeado</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-body">
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Pantalla de preguntas -->
        <div id="quiz-screen" class="hidden">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 id="question-number">Pregunta 1/10</h2>
                <button class="btn language-toggle" id="language-btn" onclick="toggleLanguage()">üåê Espa√±ol</button>
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="progress-bar" style="width: 10%;"></div>
            </div>
            
            <div class="question" id="question-text">
                <!-- La pregunta se cargar√° aqu√≠ -->
            </div>
            
            <div class="options" id="options-container">
                <!-- Las opciones se cargar√°n aqu√≠ -->
            </div>
            
            <div style="margin-top: 20px;">
                <button class="btn" id="prev-btn" onclick="prevQuestion()" style="display: none;">‚Üê Anterior</button>
                <button class="btn" id="next-btn" onclick="nextQuestion()">Siguiente ‚Üí</button>
                <button class="btn btn-success" id="finish-btn" onclick="finishQuiz()" style="display: none;">Finalizar Quiz</button>
            </div>
        </div>
        
        <!-- Pantalla de resultados -->
        <div id="results-screen" class="hidden">
            <h2>Quiz Completado!</h2>
            <div class="score-display" id="score-display">
                <!-- Los resultados se mostrar√°n aqu√≠ -->
            </div>
            
            <div id="wrong-answers-container" style="margin: 20px 0;">
                <!-- Preguntas incorrectas se mostrar√°n aqu√≠ -->
            </div>
            
            <button class="btn" onclick="showStartScreen()">Volver al Men√∫ Principal</button>
            <button class="btn btn-success" onclick="startQuiz()">Repetir Quiz</button>
        </div>
    </div>

    <!-- Cargar Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    
    <script>
        // Variables globales
        let pyodide;
        let quizData = {
            currentQuestion: 0,
            score: 0,
            selectedQuestions: [],
            answers: {},
            questionPoints: {},
            wrongQuestions: [],
            currentLanguage: "en",
            studentName: "",
            studentId: "",
            results: []
        };

        // Preguntas del quiz - TODAS LAS 50 PREGUNTAS INTEGRADAS
        const questions = [
            // Preguntas 1-25 (simples)
            {"en": "Produce hides widely used in the leather industry.", 
             "es": "Produce cueros ampliamente utilizados en la industria del cuero.",
             "answer": "Cattle", "number": 1},
            {"en": "Have no teeth; they grind food in the gizzard.", 
             "es": "No tienen dientes; trituran la comida en la molleja.",
             "answer": "Poultry", "number": 2},
            {"en": "Gestation period famously called '3 months, 3 weeks, 3 days.'", 
             "es": "Periodo de gestaci√≥n famosamente llamado '3 meses, 3 semanas, 3 d√≠as.'",
             "answer": "Pigs", "number": 3},
            {"en": "Often raised in flocks for grazing in open pastures.", 
             "es": "Suelen criarse en reba√±os para pastar en pastizales abiertos.",
             "answer": "Sheep", "number": 4},
            {"en": "Iconic breeds include Angus, Holstein, and Hereford.", 
             "es": "Las razas ic√≥nicas incluyen Angus, Holstein y Hereford.",
             "answer": "Cattle", "number": 5},
            {"en": "Laying hens produce around 250‚Äì300 eggs per year.", 
             "es": "Las gallinas ponedoras producen alrededor de 250-300 huevos por a√±o.",
             "answer": "Poultry", "number": 6},
            {"en": "Provide pork cuts such as ham, bacon, and ribs.", 
             "es": "Proporcionan cortes de cerdo como jam√≥n, tocino y costillas.",
             "answer": "Pigs", "number": 7},
            {"en": "Milk is mainly used for cheese like Roquefort or Manchego.", 
             "es": "La leche se utiliza principalmente para quesos como Roquefort o Manchego.",
             "answer": "Sheep", "number": 8},
            {"en": "Excellent climbers, able to move on rocky and steep terrain.", 
             "es": "Excelentes trepadores, capaces de moverse en terrenos rocosos y empinados.",
             "answer": "Goats", "number": 9},
            {"en": "Produce wool that must be sheared at least once a year.", 
             "es": "Producen lana que debe esquilarse al menos una vez al a√±o.",
             "answer": "Sheep", "number": 10},
            {"en": "Provide both eggs and white meat as main products.", 
             "es": "Proporcionan tanto huevos como carne blanca como productos principales.",
             "answer": "Poultry", "number": 11},
            {"en": "Main source of beef and dairy products.", 
             "es": "Fuente principal de carne de res y productos l√°cteos.",
             "answer": "Cattle", "number": 12},
            {"en": "Have a sensitive snout used for rooting in soil.", 
             "es": "Tienen un hocico sensible utilizado para hozar en el suelo.",
             "answer": "Pigs", "number": 13},
            {"en": "Produce highly nutritious milk, often used for specialty cheeses.", 
             "es": "Producen leche altamente nutritiva, a menudo utilizada para quesos especiales.",
             "answer": "Goats", "number": 14},
            {"en": "Broiler breeds like Cornish Cross grow to market weight in 6‚Äì8 weeks.", 
             "es": "Las razas de pollos de engorde como Cornish Cross alcanzan el peso de mercado en 6-8 semanas.",
             "answer": "Poultry", "number": 15},
            {"en": "Can weigh over 1,200 kg in some breeds.", 
             "es": "Pueden pesar m√°s de 1,200 kg en algunas razas.",
             "answer": "Cattle", "number": 16},
            {"en": "Breeds include Merino and Suffolk, known for fine wool.", 
             "es": "Las razas incluyen Merino y Suffolk, conocidas por su lana fina.",
             "answer": "Sheep", "number": 17},
            {"en": "Beards and horns are common in both males and females.", 
             "es": "Las barbas y los cuernos son comunes tanto en machos como en hembras.",
             "answer": "Goats", "number": 18},
            {"en": "Extremely intelligent, capable of learning tricks and solving problems.", 
             "es": "Extremadamente inteligentes, capaces de aprender trucos y resolver problemas.",
             "answer": "Pigs", "number": 19},
            {"en": "Breeds like Boer (meat) and Saanen (milk) are widely recognized.", 
             "es": "Razas como Boer (carne) y Saanen (leche) son ampliamente reconocidas.",
             "answer": "Goats", "number": 20},
            {"en": "Tail docking is a common management practice.", 
             "es": "El corte de cola es una pr√°ctica de manejo com√∫n.",
             "answer": "Sheep", "number": 21},
            {"en": "Have four stomach compartments for digesting grass.", 
             "es": "Tienen cuatro compartimentos estomacales para digerir hierba.",
             "answer": "Cattle", "number": 22},
            {"en": "Very curious and mischievous behavior.", 
             "es": "Comportamiento muy curioso y travieso.",
             "answer": "Goats", "number": 23},
            {"en": "Breeds include Yorkshire and Duroc, common in commercial farming.", 
             "es": "Las razas incluyen Yorkshire y Duroc, comunes en la ganader√≠a comercial.",
             "answer": "Pigs", "number": 24},
            {"en": "Chickens have a comb and wattles as distinctive features.", 
             "es": "Los pollos tienen cresta y barbillas como caracter√≠sticas distintivas.",
             "answer": "Poultry", "number": 25},
            
            // Preguntas 26-50 (con √≥rganos)
            {"en": "This organ has four compartments: rumen, reticulum, omasum, and abomasum. It allows the animal to digest fiber efficiently.", 
             "es": "Este √≥rgano tiene cuatro compartimentos: rumen, ret√≠culo, omaso y abomaso. Permite al animal digerir fibra eficientemente.",
             "answer": "Cow (Bovine stomach)", "number": 26},
            {"en": "This organ is long and spiral-shaped, specialized for absorbing nutrients in monogastric animals.", 
             "es": "Este √≥rgano es largo y en forma de espiral, especializado para absorber nutrientes en animales monog√°stricos.",
             "answer": "Pig (Small intestine)", "number": 27},
            {"en": "This organ is small and bean-shaped, filtering nitrogen waste in uric acid instead of urea.", 
             "es": "Este √≥rgano es peque√±o y con forma de frijol, filtra desechos nitrogenados en √°cido √∫rico en lugar de urea.",
             "answer": "Poultry (Kidney)", "number": 28},
            {"en": "This organ produces lanolin and helps regulate body temperature through wool follicles.", 
             "es": "Este √≥rgano produce lanolina y ayuda a regular la temperatura corporal a trav√©s de los fol√≠culos de lana.",
             "answer": "Sheep (Skin)", "number": 29},
            {"en": "This organ is bilobed and produces enzymes for milk digestion in young ruminants.", 
             "es": "Este √≥rgano es bilobulado y produce enzimas para la digesti√≥n de la leche en rumiantes j√≥venes.",
             "answer": "Goat (Abomasum in kids)", "number": 30},
            {"en": "This muscular organ grinds food with the help of grit and stones swallowed by the animal.", 
             "es": "Este √≥rgano muscular tritura la comida con la ayuda de arenilla y piedras tragadas por el animal.",
             "answer": "Poultry (Gizzard)", "number": 31},
            {"en": "This organ has a large cecum that ferments fibrous plant material, though not as big as in horses.", 
             "es": "Este √≥rgano tiene un ciego grande que fermenta material vegetal fibroso, aunque no tan grande como en los caballos.",
             "answer": "Pig (Cecum)", "number": 32},
            {"en": "This organ has horizontal pupils, giving a wide field of vision to detect predators.", 
             "es": "Este √≥rgano tiene pupilas horizontales, dando un amplio campo de visi√≥n para detectar depredadores.",
             "answer": "Goat (Eyes)", "number": 33},
            {"en": "This organ is massive in size, taking up much of the abdominal cavity and responsible for rumination.", 
             "es": "Este √≥rgano es masivo en tama√±o, ocupa gran parte de la cavidad abdominal y es responsable de la rumia.",
             "answer": "Cow (Rumen)", "number": 34},
            {"en": "This organ has air sacs that extend into bones, making respiration highly efficient.", 
             "es": "Este √≥rgano tiene sacos a√©reos que se extienden hasta los huesos, haciendo la respiraci√≥n altamente eficiente.",
             "answer": "Poultry (Respiratory system)", "number": 35},
            {"en": "This organ in males is spiral-shaped and adapted for quick copulation.", 
             "es": "Este √≥rgano en los machos tiene forma espiral y est√° adaptado para una c√≥pula r√°pida.",
             "answer": "Sheep (Penis)", "number": 36},
            {"en": "This organ has strong canines and molars adapted for crushing hard grains and mastication.", 
             "es": "Este √≥rgano tiene caninos y molares fuertes adaptados para triturar granos duros y masticar.",
             "answer": "Pig (Teeth)", "number": 37},
            {"en": "This organ secretes wax that protects the ear canal and is particularly large in dairy animals.", 
             "es": "Este √≥rgano secreta cera que protege el canal auditivo y es particularmente grande en animales lecheros.",
             "answer": "Cow (Ear gland system)", "number": 38},
            {"en": "This organ produces eggs covered with a calcium shell, unique among domestic animals.", 
             "es": "Este √≥rgano produce huevos cubiertos con una c√°scara de calcio, √∫nico entre los animales dom√©sticos.",
             "answer": "Poultry (Ovary/Oviduct)", "number": 39},
            {"en": "This organ has a large rumen but is relatively smaller compared to cattle, making them more selective feeders.", 
             "es": "Este √≥rgano tiene un rumen grande pero relativamente m√°s peque√±o en comparaci√≥n con el ganado, lo que los hace alimentadores m√°s selectivos.",
             "answer": "Goat (Stomach)", "number": 40},
            {"en": "This organ is double-lobed, producing bile but lacking a gall bladder in some species.", 
             "es": "Este √≥rgano es bilobulado, produce bilis pero carece de ves√≠cula biliar en algunas especies.",
             "answer": "Sheep (Liver)", "number": 41},
            {"en": "This organ has a spiral colon that improves absorption in omnivores.", 
             "es": "Este √≥rgano tiene un colon espiral que mejora la absorci√≥n en omn√≠voros.",
             "answer": "Pig (Large intestine)", "number": 42},
            {"en": "This organ is responsible for producing milk with high butterfat content compared to other ruminants.", 
             "es": "Este √≥rgano es responsable de producir leche con alto contenido de grasa but√≠rica en comparaci√≥n con otros rumiantes.",
             "answer": "Sheep (Mammary gland)", "number": 43},
            {"en": "This organ is strong and muscular, pumping blood through a four-chambered structure in all livestock species.", 
             "es": "Este √≥rgano es fuerte y muscular, bombea sangre a trav√©s de una estructura de cuatro c√°maras en todas las especies de ganado.",
             "answer": "Cow (Heart)", "number": 44},
            {"en": "This organ filters blood but has a long, slender shape in ruminants.", 
             "es": "Este √≥rgano filtra la sangre pero tiene una forma larga y delgada en rumiantes.",
             "answer": "Goat (Spleen)", "number": 45},
            {"en": "This organ has a crop where food is temporarily stored before digestion.", 
             "es": "Este √≥rgano tiene un buche donde la comida se almacena temporalmente antes de la digesti√≥n.",
             "answer": "Poultry (Crop)", "number": 46},
            {"en": "This organ has horns that curve outward in males, used for defense and dominance.", 
             "es": "Este √≥rgano tiene cuernos que se curvan hacia afuera en los machos, utilizados para defensa y dominancia.",
             "answer": "Goat (Horn)", "number": 47},
            {"en": "This organ can produce large amounts of saliva‚Äîup to 150 liters a day for digestion.", 
             "es": "Este √≥rgano puede producir grandes cantidades de saliva‚Äîhasta 150 litros al d√≠a para la digesti√≥n.",
             "answer": "Cow (Salivary glands)", "number": 48},
            {"en": "This organ produces thick skin that is often used for leather and hides.", 
             "es": "Este √≥rgano produce piel gruesa que a menudo se utiliza para cuero y pieles.",
             "answer": "Pig (Skin)", "number": 49},
            {"en": "This organ produces wool fibers that have commercial value.", 
             "es": "Este √≥rgano produce fibras de lana que tienen valor comercial.",
             "answer": "Sheep (Skin/wool follicles)", "number": 50}
        ];

        // Inicializar Pyodide
        async function initializePyodide() {
            try {
                console.log("Cargando Pyodide...");
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/"
                });
                console.log("Pyodide cargado correctamente");
                
                // Configurar el estado inicial
                showStartScreen();
            } catch (error) {
                console.error("Error al cargar Pyodide:", error);
                alert("Error al cargar el entorno Python. Por favor, recarga la p√°gina.");
            }
        }

        // Funciones de navegaci√≥n de pantallas
        function showStartScreen() {
            hideAllScreens();
            document.getElementById('start-screen').classList.remove('hidden');
        }

        function showTeacherLogin() {
            hideAllScreens();
            document.getElementById('teacher-login').classList.remove('hidden');
        }

        function showAdminMenu() {
            hideAllScreens();
            document.getElementById('admin-menu').classList.remove('hidden');
        }

        function showQuizScreen() {
            hideAllScreens();
            document.getElementById('quiz-screen').classList.remove('hidden');
        }

        function showResultsScreen() {
            hideAllScreens();
            document.getElementById('results-screen').classList.remove('hidden');
        }

        function hideAllScreens() {
            const screens = [
                'start-screen', 'teacher-login', 'admin-menu', 
                'quiz-screen', 'results-screen'
            ];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // Funciones del quiz
        function startQuiz() {
            const name = document.getElementById('student-name').value.trim();
            const id = document.getElementById('student-id').value.trim();
            
            if (!name) {
                alert("Por favor, ingresa tu nombre.");
                document.getElementById('student-name').focus();
                return;
            }
            
            if (!id) {
                alert("Por favor, ingresa tu ID.");
                document.getElementById('student-id').focus();
                return;
            }
            
            quizData.studentName = name;
            quizData.studentId = id;
            quizData.currentQuestion = 0;
            quizData.score = 0;
            quizData.answers = {};
            quizData.questionPoints = {};
            quizData.wrongQuestions = [];
            quizData.currentLanguage = "en";
            
            // Seleccionar 10 preguntas aleatorias
            quizData.selectedQuestions = getRandomQuestions(questions, 10);
            
            showQuizScreen();
            displayQuestion();
        }

        function getRandomQuestions(questions, count) {
            const shuffled = [...questions].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function displayQuestion() {
            const q = quizData.selectedQuestions[quizData.currentQuestion];
            const qNum = quizData.currentQuestion + 1;
            const totalQuestions = quizData.selectedQuestions.length;
            
            // Actualizar n√∫mero de pregunta y progreso
            document.getElementById('question-number').textContent = 
                `Pregunta ${qNum}/${totalQuestions}`;
            document.getElementById('progress-bar').style.width = 
                `${(qNum / totalQuestions) * 100}%`;
            
            // Mostrar pregunta en el idioma actual
            const questionText = quizData.currentLanguage === "en" ? q.en : q.es;
            document.getElementById('question-text').textContent = questionText;
            
            // Generar opciones de respuesta
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            let displayOptions;
            if (q.number >= 26) {
                // Para preguntas de √≥rganos (26-50)
                displayOptions = generateOrganOptions(q.answer);
            } else {
                // Para preguntas simples (1-25)
                displayOptions = generateSimpleOptions(q.answer);
            }
            
            // Mezclar opciones
            displayOptions = shuffleArray(displayOptions);
            
            // Crear elementos de opci√≥n
            displayOptions.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = function() {
                    // Deseleccionar todas las opciones
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // Seleccionar esta opci√≥n
                    this.classList.add('selected');
                    // Guardar respuesta
                    quizData.answers[quizData.currentQuestion] = option;
                };
                optionsContainer.appendChild(optionDiv);
            });
            
            // Seleccionar opci√≥n previamente respondida si existe
            const previousAnswer = quizData.answers[quizData.currentQuestion];
            if (previousAnswer) {
                document.querySelectorAll('.option').forEach(opt => {
                    if (opt.textContent === previousAnswer) {
                        opt.classList.add('selected');
                    }
                });
            }
            
            // Actualizar botones de navegaci√≥n
            document.getElementById('prev-btn').style.display = 
                quizData.currentQuestion > 0 ? 'inline-block' : 'none';
            document.getElementById('next-btn').style.display = 
                quizData.currentQuestion < totalQuestions - 1 ? 'inline-block' : 'none';
            document.getElementById('finish-btn').style.display = 
                quizData.currentQuestion === totalQuestions - 1 ? 'inline-block' : 'none';
        }

        function generateSimpleOptions(correctAnswer) {
            const allOptions = ["Cattle", "Poultry", "Pigs", "Sheep", "Goats"];
            // Asegurar que la respuesta correcta est√© presente
            if (!allOptions.includes(correctAnswer)) {
                allOptions[Math.floor(Math.random() * allOptions.length)] = correctAnswer;
            }
            return allOptions;
        }

        function generateOrganOptions(correctAnswer) {
            const allOptions = [
                "Cow (Bovine stomach)", "Poultry (Gizzard)", "Pig (Small intestine)", 
                "Sheep (Skin)", "Goat (Abomasum in kids)", "Poultry (Kidney)",
                "Pig (Cecum)", "Goat (Eyes)", "Cow (Rumen)", "Poultry (Respiratory system)",
                "Sheep (Penis)", "Pig (Teeth)", "Cow (Ear gland system)", "Poultry (Ovary/Oviduct)",
                "Goat (Stomach)", "Sheep (Liver)", "Pig (Large intestine)", "Sheep (Mammary gland)",
                "Cow (Heart)", "Goat (Spleen)", "Poultry (Crop)", "Goat (Horn)", 
                "Cow (Salivary glands)", "Pig (Skin)", "Sheep (Skin/wool follicles)"
            ];
            
            // Remover la respuesta correcta
            const wrongOptions = allOptions.filter(opt => opt !== correctAnswer);
            
            // Seleccionar 4 opciones incorrectas aleatorias
            const selectedWrongOptions = getRandomQuestions(wrongOptions, 4);
            
            // Combinar y devolver
            return [...selectedWrongOptions, correctAnswer];
        }

        function shuffleArray(array) {
            return array.sort(() => 0.5 - Math.random());
        }

        function toggleLanguage() {
            quizData.currentLanguage = quizData.currentLanguage === "en" ? "es" : "en";
            document.getElementById('language-btn').textContent = 
                quizData.currentLanguage === "en" ? "üåê Espa√±ol" : "üåê English";
            
            // Guardar que el estudiante us√≥ espa√±ol para esta pregunta
            const currentQNum = quizData.currentQuestion + 1;
            if (!quizData.questionPoints[currentQNum]) {
                quizData.questionPoints[currentQNum] = {};
            }
            quizData.questionPoints[currentQNum].usedSpanish = (quizData.currentLanguage === "es");
            
            displayQuestion();
        }

        function nextQuestion() {
            if (quizData.currentQuestion < quizData.selectedQuestions.length - 1) {
                quizData.currentQuestion++;
                displayQuestion();
            }
        }

        function prevQuestion() {
            if (quizData.currentQuestion > 0) {
                quizData.currentQuestion--;
                displayQuestion();
            }
        }

        function finishQuiz() {
            // Calcular puntaje
            calculateScore();
            
            // Guardar resultado
            saveResult();
            
            // Mostrar resultados
            showResults();
        }

        function calculateScore() {
            quizData.score = 0;
            quizData.wrongQuestions = [];
            
            quizData.selectedQuestions.forEach((q, index) => {
                const questionNum = index + 1;
                const userAnswer = quizData.answers[index] || "";
                const usedSpanish = quizData.questionPoints[questionNum]?.usedSpanish || false;
                
                if (userAnswer === q.answer) {
                    const points = usedSpanish ? 1.5 : 2.0;
                    quizData.score += points;
                    quizData.questionPoints[questionNum] = {
                        points: points,
                        correct: true,
                        usedSpanish: usedSpanish
                    };
                } else {
                    quizData.questionPoints[questionNum] = {
                        points: 0,
                        correct: false,
                        usedSpanish: usedSpanish
                    };
                    
                    quizData.wrongQuestions.push({
                        number: q.number,
                        questionEn: q.en,
                        questionEs: q.es,
                        userAnswer: userAnswer,
                        correctAnswer: q.answer
                    });
                }
            });
        }

        function saveResult() {
            const percent = (quizData.score / 20) * 100;
            const roundedScore = quizData.score % 1 >= 0.5 ? 
                Math.ceil(quizData.score) : Math.round(quizData.score);
            
            const wrongQuestionsStr = quizData.wrongQuestions
                .map(wq => `Q${wq.number}`)
                .join("; ");
            
            const result = {
                name: quizData.studentName,
                document: quizData.studentId,
                score: quizData.score.toFixed(1),
                percentage: percent.toFixed(1),
                roundedScore: roundedScore,
                wrongQuestions: wrongQuestionsStr
            };
            
            quizData.results.push(result);
        }

        function showResults() {
            const percent = (quizData.score / 20) * 100;
            const roundedScore = quizData.score % 1 >= 0.5 ? 
                Math.ceil(quizData.score) : Math.round(quizData.score);
            
            let emoji, color;
            if (percent >= 90) {
                emoji = "üéâ";
                color = "#27ae60";
            } else if (percent >= 70) {
                emoji = "üëç";
                color = "#f39c12";
            } else {
                emoji = "üìö";
                color = "#e74c3c";
            }
            
            document.getElementById('score-display').innerHTML = `
                <div>Nombre: <strong>${quizData.studentName}</strong></div>
                <div>ID: <strong>${quizData.studentId}</strong></div>
                <div style="color: ${color}; margin-top: 10px;">
                    Puntaje: ${quizData.score.toFixed(1)}/20 (${percent.toFixed(1)}%) ${emoji}
                </div>
                <div>Puntaje Redondeado: <strong>${roundedScore}/20</strong></div>
            `;
            
            // Mostrar preguntas incorrectas si las hay
            const wrongAnswersContainer = document.getElementById('wrong-answers-container');
            if (quizData.wrongQuestions.length > 0) {
                wrongAnswersContainer.innerHTML = '<h3>Preguntas Incorrectas:</h3>';
                
                quizData.wrongQuestions.forEach(wq => {
                    const wrongDiv = document.createElement('div');
                    wrongDiv.className = 'question';
                    wrongDiv.innerHTML = `
                        <div><strong>Pregunta ${wq.number}:</strong></div>
                        <div>${wq.questionEs}</div>
                        <div style="margin-top: 10px;">
                            <span class="wrong-answer">Tu respuesta: ${wq.userAnswer || "Sin responder"}</span><br>
                            <span class="correct-answer">Respuesta correcta: ${wq.correctAnswer}</span>
                        </div>
                    `;
                    wrongAnswersContainer.appendChild(wrongDiv);
                });
            } else {
                wrongAnswersContainer.innerHTML = '<p>¬°Perfecto! No tienes preguntas incorrectas.</p>';
            }
            
            showResultsScreen();
        }

        // Funciones de administraci√≥n
        function verifyLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === "Coach" && password === "19082008") {
                showAdminMenu();
            } else {
                alert("Credenciales incorrectas. Intenta nuevamente.");
            }
        }

        function viewRanking() {
            document.getElementById('ranking-results').classList.remove('hidden');
            
            const rankingBody = document.getElementById('ranking-body');
            rankingBody.innerHTML = '';
            
            // Ordenar resultados por porcentaje
            const sortedResults = [...quizData.results].sort((a, b) => 
                parseFloat(b.percentage) - parseFloat(a.percentage));
            
            if (sortedResults.length === 0) {
                rankingBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No hay resultados a√∫n</td></tr>';
                return;
            }
            
            sortedResults.forEach((result, index) => {
                const row = document.createElement('tr');
                
                // Asignar clases para los primeros puestos
                if (index === 0) row.className = 'gold';
                else if (index === 1) row.className = 'silver';
                else if (index === 2) row.className = 'bronze';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${result.name}</td>
                    <td>${result.document}</td>
                    <td>${result.score}</td>
                    <td>${result.percentage}%</td>
                    <td>${result.roundedScore}</td>
                `;
                
                rankingBody.appendChild(row);
            });
        }

        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        window.addEventListener('load', initializePyodide);
    </script>
</body>
</html>
